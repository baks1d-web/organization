<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>Telegram WebApp</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="/static/css/style.css" />
</head>
<body>

<!-- AUTH -->
<div class="auth-screen active" id="auth">
  <div class="auth-card">
    <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å</h2>
    <p class="auth-subtitle">–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</p>

    <button class="tg-btn" onclick="loginTelegram()">–í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Telegram</button>

    <div class="divider">–∏–ª–∏</div>

    <input type="email" id="email-input" placeholder="Email" />
    <input type="password" id="password-input" placeholder="–ü–∞—Ä–æ–ª—å" />

    <button class="email-btn" onclick="loginEmail()">–í–æ–π—Ç–∏ –ø–æ –ø–æ—á—Ç–µ</button>
  </div>
</div>

<div class="app hidden" id="app">
  <header class="header">
     <div class="top-menu">
      <button class="avatar-btn" type="button" aria-label="–ü—Ä–æ—Ñ–∏–ª—å">D</button>
      <div class="top-menu-center" aria-label="–ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –¥–∞—Ç–µ">
        <button class="circle-btn" type="button" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–∏–π –¥–µ–Ω—å">‚Äπ</button>
        <div class="date-pill">
          <div class="date-title">–í—á–µ—Ä–∞</div>
          <div class="date-subtitle">–°–±, 24 —è–Ω–≤.</div>
        </div>
        <button class="circle-btn" type="button" aria-label="–°–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å">‚Ä∫</button>
      </div>
      <button class="circle-btn" type="button" aria-label="–û—Ç–∫—Ä—ã—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å">üìÖ</button>
    </div>
    <div class="screen-title" id="screen-title">–ì–ª–∞–≤–Ω–∞—è</div>
  </header>

  <main class="content">

    <!-- HOME -->
    <section class="screen active" id="home">
      <div class="card">
        <div class="filter-bar">
          <button class="chip active" onclick="setHomeFilter('today', this)">–°–µ–≥–æ–¥–Ω—è</button>
          <button class="chip" onclick="setHomeFilter('tomorrow', this)">–ó–∞–≤—Ç—Ä–∞</button>
          <button class="chip" onclick="setHomeFilter('5plus', this)">5+ –¥–Ω–µ–π</button>
          <button class="chip" onclick="setHomeFilter('all', this)">–í—Å–µ</button>

          <div class="chip-right">
            <span class="flame">üî•</span>
            <span id="home-urgent-count">0</span>
          </div>
        </div>

        <div id="home-tasks"></div>
      </div>

      <div class="card">
        <h3>–ë–∞–ª–∞–Ω—Å</h3>
        <div class="balance" id="home-balance">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
      </div>
    </section>

    <!-- TASKS -->
    <section class="screen" id="tasks">
      <div class="card">
        <h3>–í—Å–µ –∑–∞–¥–∞—á–∏</h3>
        <div id="all-tasks"></div>
      </div>
    </section>

    <!-- FINANCE -->
    <section class="screen" id="finance">
      <div class="card">
        <h3>–§–∏–Ω–∞–Ω—Å—ã</h3>
        <div id="finance-list"></div>
      </div>
    </section>


    <!-- HABITS -->
    <section class="screen" id="habits">
      <div class="habits-wrap">
        <div class="habits-toggle">
          <button class="seg-btn active" id="habits-week-btn" onclick="setHabitsView('week')">
            <span class="seg-icon">‚ñÆ‚ñÆ‚ñÆ</span> –ù–µ–¥–µ–ª—è
          </button>
          <button class="seg-btn" id="habits-month-btn" onclick="setHabitsView('month')">
            <span class="seg-icon">‚ñ¶</span> –ú–µ—Å—è—Ü
          </button>
        </div>

        <div class="habits-progress">
          <div class="habits-bar"><div class="habits-bar-fill" id="habits-bar-fill"></div></div>
          <div class="habits-bar-text" id="habits-bar-text">0 / 0</div>
        </div>

        <div id="habits-list"></div>

        <button class="habits-add" onclick="openHabitModal()">Ôºã –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–∏–≤—ã—á–∫—É</button>
      </div>
    </section>

    <!-- COMMON -->
    <section class="screen" id="group_tasks">

      <!-- Groups list -->
      <div class="card">
        <div class="top-row">
          <div class="top-row-left">
            <h3 style="margin:0;">–û–±—â–∏–µ –≥—Ä—É–ø–ø—ã</h3>
            <div class="muted small">–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥—Ä—É–ø–ø –∏ —Å–æ—Å—Ç–æ—è—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö.</div>
          </div>
          <button class="mini-btn" onclick="openCreateGroupModal()">Ôºã –°–æ–∑–¥–∞—Ç—å</button>
        </div>

        <div id="groups-list" class="groups-list"></div>
      </div>

      <!-- Selected group header -->
      <div class="card hidden" id="shared-group-header">
        <div class="top-row">
          <div class="top-row-left">
            <div class="muted">–í—ã–±—Ä–∞–Ω–∞ –≥—Ä—É–ø–ø–∞</div>
            <div class="group-selected" id="selected-group-name">‚Äî</div>
          </div>
          <div class="top-row-right">
  <button class="mini-btn" onclick="openInviteUserModal()">–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å</button>
</div>

<div class="invite-box hidden" id="invite-by-username-box">
  <div class="muted">–ü—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:</div>
  <div class="muted" id="invite-username-result">‚Äî</div>
</div>

        </div>

        <div class="invite-box hidden" id="invite-box">
          <div class="muted">–û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è —Å—Å—ã–ª–∫–∞:</div>
          <div class="invite-row">
            <input id="invite-link" readonly />
            <button class="mini-btn" onclick="copyInvite()">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
          </div>
        </div>
      </div>

      <!-- Tabs -->
      <div class="card hidden" id="shared-group-tabs">
        <div class="segmented">
          <button class="seg-btn active" id="tab-tasks" onclick="setCommonTab('tasks')">–ó–∞–¥–∞—á–∏</button>
          <button class="seg-btn" id="tab-finance" onclick="setCommonTab('finance')">–§–∏–Ω–∞–Ω—Å—ã</button>
        </div>
      </div>

      <!-- Common tasks panel -->
      <div class="card hidden" id="shared-group-tasks-card">
        <div class="filter-bar">
          <button class="chip active" onclick="setGroupFilter('today', this)">–°–µ–≥–æ–¥–Ω—è</button>
          <button class="chip" onclick="setGroupFilter('tomorrow', this)">–ó–∞–≤—Ç—Ä–∞</button>
          <button class="chip" onclick="setGroupFilter('5plus', this)">5+ –¥–Ω–µ–π</button>
          <button class="chip" onclick="setGroupFilter('all', this)">–í—Å–µ</button>

          <div class="chip-right">
            <span class="flame">üî•</span>
            <span id="urgent-count">0</span>
          </div>
        </div>

        <div id="group-tasks-list"></div>
      </div>

      <!-- Common finance panel -->
      <div class="card hidden" id="shared-group-finance-card">
        <div class="top-row">
          <div class="top-row-left">
            <div class="muted">–ë–∞–ª–∞–Ω—Å –≥—Ä—É–ø–ø—ã</div>
            <div class="balance" id="group-balance">‚Äî</div>
          </div>
          <div class="top-row-right">
            <button class="mini-btn" onclick="openManageModal('categories')">–°—Ç–∞—Ç—å–∏</button>
            <button class="mini-btn" onclick="openManageModal('methods')">–°–ø–æ—Å–æ–±—ã</button>
          </div>
        </div>

        <div style="margin-top:12px">
          <h3 style="margin:0 0 10px; color:#6b7280; font-size:14px; font-weight:500;">–û–ø–µ—Ä–∞—Ü–∏–∏</h3>
          <div id="group-finance-list"></div>
        </div>
      </div>

    </section>

    <!-- SETTINGS -->
    <section class="screen" id="settings">
      <div class="card">
        <h3>–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h3>

        <div class="setting-row">
          <div class="setting-text">
            <div class="setting-title">–ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞</div>
            <div class="setting-sub">–ö–æ–≥–¥–∞ –≤–∞–º –Ω–∞–∑–Ω–∞—á–∏–ª–∏ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É</div>
          </div>
          <label class="switch">
            <input type="checkbox" id="notify-new-task">
            <span class="slider"></span>
          </label>
        </div>

        <div class="setting-row">
          <div class="setting-text">
            <div class="setting-title">–ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á</div>
            <div class="setting-sub">–ö–æ–≥–¥–∞ –∏–∑–º–µ–Ω–∏–ª–∏ –∑–∞–¥–∞—á—É, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—É—é –≤–∞–º</div>
          </div>
          <label class="switch">
            <input type="checkbox" id="notify-task-updates">
            <span class="slider"></span>
          </label>
        </div>

        <button class="save-btn" onclick="saveNotificationSettings()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>

        <div class="muted small" style="margin-top:10px;">
          –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞.
        </div>
      </div>
    </section>
  </main>

  <button class="add-btn" onclick="openAddModal()">Ôºã –î–æ–±–∞–≤–∏—Ç—å</button>

  <nav class="bottom-nav">
    <div class="nav-item active" onclick="switchScreen('home', '–ì–ª–∞–≤–Ω–∞—è', this)">üè†<span>–ì–ª–∞–≤–Ω</span></div>
    <div class="nav-item" onclick="switchScreen('tasks', '–ó–∞–¥–∞—á–∏', this)">‚úÖ<span>–ó–∞–¥–∞—á–∏</span></div>
    <div class="nav-item" onclick="switchScreen('finance', '–§–∏–Ω–∞–Ω—Å—ã', this)">üí∞<span>–§–∏–Ω–∞–Ω—Å—ã</span></div>
    <div class="nav-item" onclick="switchScreen('habits', '–ü—Ä–∏–≤—ã—á–∫–∏', this)">üîÅ<span>–ü—Ä–∏–≤—ã—á–∫–∏</span></div>
    <div class="nav-item" id="nav-group-tasks" onclick="switchScreen('group_tasks', '–û–±—â–∏–µ', this)">üë•<span>–û–±—â–∏–µ</span></div>
  </nav>
</div>

<!-- CREATE GROUP MODAL -->
<div class="modal hidden" id="create-group-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–°–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—É</h3>
      <button class="icon-btn" onclick="closeCreateGroupModal()">‚úï</button>
    </div>

    <input type="text" id="create-group-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã" />

    <div class="modal-actions">
      <button class="ghost-btn" onclick="closeCreateGroupModal()">–û—Ç–º–µ–Ω–∞</button>
      <button class="save-btn" onclick="createGroup()">–°–æ–∑–¥–∞—Ç—å</button>
    </div>
  </div>
</div>
<!-- INVITE USER MODAL -->
<div class="modal hidden" id="invite-user-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–ü—Ä–∏–≥–ª–∞—Å–∏—Ç—å –ø–æ –Ω–∏–∫—É</h3>
      <button class="icon-btn" onclick="closeInviteUserModal()">‚úï</button>
    </div>

    <input type="text" id="invite-username-input" placeholder="@username" />

    <div class="modal-actions">
      <button class="ghost-btn" onclick="closeInviteUserModal()">–û—Ç–º–µ–Ω–∞</button>
      <button class="save-btn" onclick="sendInviteByUsername()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </div>

    <div class="muted small" style="margin-top:10px;">
      –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω—è—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ –≤ —Å–≤–æ—ë–º –±–æ—Ç–µ.
    </div>
  </div>
</div>


<!-- ADD MODAL -->
<div class="modal hidden" id="add-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–î–æ–±–∞–≤–∏—Ç—å</h3>
      <button class="icon-btn" onclick="closeAddModal()">‚úï</button>
    </div>

    <div class="radio-group">
      <label><input type="radio" name="add-type" value="task" checked onchange="renderAddType()"> –ó–∞–¥–∞—á–∞</label>
      <label><input type="radio" name="add-type" value="income" onchange="renderAddType()"> –î–æ—Ö–æ–¥</label>
      <label><input type="radio" name="add-type" value="expense" onchange="renderAddType()"> –†–∞—Å—Ö–æ–¥</label>
    </div>

    <div id="add-task-fields">
      <input type="text" id="add-task-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏" />
      <textarea id="add-task-desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>

      <div class="row">
        <label class="label">–°—Ä–æ–∫ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è</label>
        <input type="date" id="add-task-deadline" />
      </div>

      <div class="row">
        <label class="label">–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</label>
        <div class="muted small" style="margin-bottom:8px;">
          –°–ø–∏—Å–æ–∫ –≤–∫–ª—é—á–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—É—Å–∫–∞–ª–∏ –±–æ—Ç–∞.
        </div>
        <div id="add-task-assignees" class="assignees"></div>
      </div>
    </div>

    <div id="add-finance-fields" class="hidden">
      <textarea id="add-fin-desc" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ (–Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)"></textarea>
      <input type="number" id="add-fin-amount" placeholder="–°—É–º–º–∞" />

      <div class="row">
        <label class="label">–°—Ç–∞—Ç—å—è</label>
        <div class="select-row">
          <select id="add-fin-category"></select>
          <button class="mini-btn" onclick="openManageModal('categories')">‚úé</button>
        </div>
      </div>

      <div class="row">
        <label class="label">–°–ø–æ—Å–æ–±</label>
        <div class="select-row">
          <select id="add-fin-method"></select>
          <button class="mini-btn" onclick="openManageModal('methods')">‚úé</button>
        </div>
      </div>

      <div class="muted small">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–µ–π/—Å–ø–æ—Å–æ–±–æ–≤ –¥–æ—Å—Ç—É–ø–Ω–æ –≤ ‚Äú–û–±—â–∏–µ ‚Üí –§–∏–Ω–∞–Ω—Å—ã‚Äù.</div>
    </div>

    <div class="modal-actions">
      <button class="ghost-btn" onclick="closeAddModal()">–û—Ç–º–µ–Ω–∞</button>
      <button class="save-btn" onclick="saveAddModal()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
  </div>
</div>

<!-- MANAGE LIST MODAL -->
<div class="modal hidden" id="manage-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="manage-title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</h3>
      <button class="icon-btn" onclick="closeManageModal()">‚úï</button>
    </div>

    <div id="manage-items" class="manage-list"></div>

    <div class="manage-add-row">
      <input type="text" id="manage-new-name" placeholder="–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ..." />
      <button class="mini-btn" onclick="manageAdd()">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>

    <div class="modal-actions">
      <button class="ghost-btn" onclick="closeManageModal()">–ì–æ—Ç–æ–≤–æ</button>
    </div>
  </div>
</div>

<!-- TASK DETAILS MODAL -->
<div class="modal hidden" id="task-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–ó–∞–¥–∞—á–∞</h3>
      <button class="icon-btn" onclick="closeTaskModal()">‚úï</button>
    </div>

    <div class="row">
      <label class="label">–°—Ç–∞—Ç—É—Å</label>
      <select id="task-status">
        <option value="new">–ù–æ–≤–∞—è</option>
        <option value="in_progress">–í —Ä–∞–±–æ—Ç–µ</option>
        <option value="postponed">–û—Ç–ª–æ–∂–µ–Ω–∞</option>
        <option value="done">–ì–æ—Ç–æ–≤–∞</option>
      </select>
    </div>

    <input type="text" id="task-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ" />
    <textarea id="task-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ"></textarea>

    <div class="row">
      <label class="label">–ö—Ä–∞–π–Ω–∏–π —Å—Ä–æ–∫</label>
      <input type="date" id="task-deadline" />
    </div>

    <div class="row">
      <label class="label">–ö—Ç–æ –Ω–∞–∑–Ω–∞—á–∏–ª</label>
      <div class="muted" id="task-assigned-by">‚Äî</div>
    </div>

    <div class="row">
      <label class="label">–î–æ–ø. –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏</label>
      <div class="muted small" style="margin-bottom:8px;">
        –ú–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å –ª—é–±—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–æ—Ç–∞ ‚Äî –æ–Ω–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –≥—Ä—É–ø–ø—É.
      </div>
      <div id="task-assignees" class="assignees"></div>
    </div>

    <label class="checkbox-row">
      <input type="checkbox" id="task-done" />
      <span>–ó–∞–∫—Ä—ã—Ç—å –∑–∞–¥–∞—á—É</span>
    </label>

    <button class="save-btn" onclick="saveTaskDetails()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
  </div>
</div>

<script src="/static/js/app.js"></script>

<!-- ADD HABIT MODAL -->
<div class="modal hidden" id="habit-modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>–ù–æ–≤–∞—è –ø—Ä–∏–≤—ã—á–∫–∞</h3>
      <button class="btn ghost" onclick="closeHabitModal()">‚úï</button>
    </div>
    <div class="form-row">
      <input id="habit-title" class="input" type="text" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ù–µ –∫—É—Ä—é)" />
    </div>
    <div class="modal-actions">
      <button class="btn" onclick="createHabit()">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>
  </div>
</div>

</body>
</html>
